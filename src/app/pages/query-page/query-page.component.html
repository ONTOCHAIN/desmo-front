<div class="grid-container">
  <h1 class="mat-h1">Query execution</h1>
  <mat-card>
    <mat-card-content>
      <mat-card-title>Build your query</mat-card-title>
      <span style="color: red">Hint: remember that you can use prefixes to shorten the IRIs!</span>

      <mat-vertical-stepper
        linear
        animationDuration="1500"
        (selectionChange)="handlePrefixes($event)"
        #stepper
      >
        <!-- STEP 1: property -->
        <mat-step [stepControl]="propertyFormGroup" [optional]="false">
          <form [formGroup]="propertyFormGroup">
            <ng-template matStepLabel>Property</ng-template>
            <div>
              <mat-form-field>
                <mat-label>Insert property IRI:</mat-label>
                <input
                  matInput
                  type="text"
                  formControlName="propertyIRI"
                  placeholder="Property IRI here..."
                  #propertyIRIinput
                />
                <button
                  mat-icon-button
                  matSuffix
                  color="accent"
                  aria-label="Clear field"
                  *ngIf="propertyIRIinput.value != ''"
                  (click)="clearPropertyControl('propertyIRI')"
                >
                  <mat-icon>clear</mat-icon>
                </button>
              </mat-form-field>
            </div>
            <div style="margin-top: 16px">
              <mat-form-field>
                <mat-label>Insert unit IRI:</mat-label>
                <input
                  matInput
                  type="text"
                  formControlName="unitIRI"
                  placeholder="Unit IRI here..."
                  #unitIRIinput
                />
                <button
                  mat-icon-button
                  matSuffix
                  color="accent"
                  aria-label="Clear field"
                  *ngIf="unitIRIinput.value != ''"
                  (click)="clearPropertyControl('unitIRI')"
                >
                  <mat-icon>clear</mat-icon>
                </button>
              </mat-form-field>
            </div>
            <div style="margin-top: 16px" [formGroup]="propertyFormGroup">
              <div>
                <mat-label>Select the desired datatype:</mat-label>
              </div>
              <div>
                <mat-button-toggle-group
                  formControlName="datatype"
                  name="datatype"
                  aria-label="Data type"
                  multiple="false"
                  required
                >
                  <mat-button-toggle [value]="0">Integer</mat-button-toggle>
                  <mat-button-toggle [value]="1">Decimal</mat-button-toggle>
                  <mat-button-toggle [value]="2">Boolean</mat-button-toggle>
                  <mat-button-toggle [value]="3">String</mat-button-toggle>
                </mat-button-toggle-group>
              </div>
            </div>

            <div style="margin-top: 16px">
              <button mat-button mat-stroked-button matStepperNext>
                Next step
              </button>
            </div>
          </form>
        </mat-step>

        <!-- STEP 2: filters (static, dynamic, geographical, temporal) -->
        <mat-step [stepControl]="filtersFormGroup" [optional]="true">
          <form [formGroup]="filtersFormGroup">
            <ng-template matStepLabel>Filters</ng-template>
            <div>
              <mat-form-field>
                <mat-label>Insert JsonPath filter expression:</mat-label>
                <span matPrefix>$.</span>
                <input
                  matInput
                  placeholder="JsonPath filter here..."
                  formControlName="jsonPathExpression"
                  #jsonPathinput
                />
                <button
                  mat-icon-button
                  matSuffix
                  color="accent"
                  aria-label="Clear field"
                  *ngIf="jsonPathinput.value != ''"
                  (click)="clearFilterControl('jsonPathExpression')"
                >
                  <mat-icon>clear</mat-icon>
                </button>
              </mat-form-field>
            </div>
            <div style="margin-top: 16px">
              <mat-form-field>
                <mat-label>Insert dynamic filter expression:</mat-label>
                <input
                  matInput
                  placeholder="Dynamic filter here..."
                  formControlName="dynamicFilterExpression"
                  #dynamicFilterinput
                />
                <button
                  mat-icon-button
                  matSuffix
                  color="accent"
                  aria-label="Clear field"
                  *ngIf="dynamicFilterinput.value != ''"
                  (click)="clearPropertyControl('dynamicFilterExpression')"
                >
                  <mat-icon>clear</mat-icon>
                </button>
              </mat-form-field>
            </div>
            <div style="margin-top: 16px">
              <button mat-button mat-stroked-button matStepperPrevious>
                Prev. step
              </button>
              <button mat-button mat-stroked-button matStepperNext>
                Next step
              </button>
            </div>
          </form>
        </mat-step>

        <!-- STEP 3: prefixes and query submission-->
        <mat-step [optional]="false">
          <ng-template matStepLabel>Done</ng-template>
          <h3 *ngIf="prefixesFormArray.length <= 0">You are now done!</h3>
          <div *ngIf="prefixesFormArray.length > 0">
            <h3>You are almost done!</h3>
            <h4>Please, provide the full version of the prefixes you used:</h4>

            <form>
              <div
                *ngFor="
                  let prefixCtrl of prefixesFormArray.controls;
                  let i = index
                "
              >
                <mat-form-field>
                  <span matPrefix>{{ prefixNames[i] }}:&nbsp;&lt;</span>
                  <input
                    matInput
                    placeholder="Extended IRI here..."
                    [formControl]="getPrefixControl(i)"
                  />
                  <button
                    mat-icon-button
                    matSuffix
                    color="accent"
                    aria-label="Clear field"
                    *ngIf="prefixesFormArray.controls[i].value != ''"
                    (click)="clearPrefixControl(i)"
                  >
                    <mat-icon>clear</mat-icon>
                  </button>
                  <span matSuffix>&gt;</span>
                </mat-form-field>
              </div>
            </form>
          </div>

          <div>
            <button mat-stroked-button matStepperPrevious>Prev. step</button>
            <button
              mat-stroked-button
              color="accent"
              (click)="resetQueryBuilder(stepper)"
            >
              Reset
            </button>
            <button
              mat-stroked-button
              color="primary"
              type="submit"
              (click)="submitQuery()"
            >
              Execute query
            </button>
          </div>
        </mat-step>
      </mat-vertical-stepper>
    </mat-card-content>
  </mat-card>
</div>
